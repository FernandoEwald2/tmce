<main id="main" class="main">
  <div class="pagetitle">
    <h2>Cadastro de Cliente</h2>
  </div>

  <section>
    <form class="row g-3" [formGroup]="clienteForm" (ngSubmit)="onSubmit()" novalidate autocomplete="off">

      <!-- CEP -->

      <div class="col-md-4">
        <label class="form-label">CEP:</label>
        <input type="text" class="form-control" formControlName="cep" placeholder="00.000-000" mask="00.000-000"
          maxlength="10" />
        <div *ngIf="carregandoCep">Buscando endereço...</div>
        <div *ngIf="erroCep" class="text-danger">{{ erroCep }}</div>
        <div *ngIf="clienteForm.get('cep')?.invalid && clienteForm.get('cep')?.touched" class="text-danger">
          CEP inválido.
        </div>
      </div>

      <!-- Logradouro -->
      <div class="col-md-4">
        <label class="form-label">Logradouro:</label>
        <input class="form-control" formControlName="logradouro" />
      </div>

      <!-- Número -->
      <div class="col-md-4">
        <label class="form-label">Número:</label>
        <input class="form-control" formControlName="numero" />
      </div>

      <!-- Bairro -->
      <div class="col-md-4">
        <label class="form-label">Bairro:</label>
        <input class="form-control" formControlName="bairro" />
      </div>

      <!-- Cidade -->
      <div class="col-md-4">
        <label class="form-label">Cidade:</label>
        <input class="form-control" formControlName="cidade" />
      </div>

      <!-- Estado -->
      <div class="col-md-4">
        <label class="form-label">Estado:</label>
        <input class="form-control" formControlName="estado" />
      </div>

      <hr class="mt-4 mb-2 w-100" />

      <!-- Tipo cliente -->
      <div class="col-md-2">
        <label class="form-label">Tipo:</label>
        <select class="form-control" formControlName="tipoCliente" (change)="onTipoChange()">
          <option value="" disabled selected>Selecione</option>
          <option *ngFor="let tipo of tipoCliente" [ngValue]="tipo.id">
            {{ tipo.value }}
          </option>
        </select>
        <div *ngIf="clienteForm.get('tipoCliente')?.touched && clienteForm.get('tipoCliente')?.invalid"
          class="text-danger">
          Tipo é obrigatório
        </div>
      </div>

      <!-- Nome -->
      <div class="col-md-4">
        <label class="form-label">Nome:</label>
        <input class="form-control" formControlName="nome" />
        <div *ngIf="clienteForm.get('nome')?.invalid && clienteForm.get('nome')?.touched" class="text-danger">
          Nome obrigatório.
        </div>
      </div>

      <!-- Telefone -->
      <div class="col-md-3">
        <label class="form-label">Telefone:</label>
        <input class="form-control" formControlName="telefone" maxlength="16" mask="(00) 0 0000 0000" type="tel" />
        <div *ngIf="clienteForm.get('telefone')?.invalid && clienteForm.get('telefone')?.touched" class="text-danger">
          Telefone obrigatório.
        </div>
      </div>

      <!-- Email -->
      <div class="col-md-3">
        <label class="form-label">Email:</label>
        <input class="form-control" formControlName="email" />
        <div *ngIf="clienteForm.get('email')?.invalid && clienteForm.get('email')?.touched" class="text-danger">
          Email obrigatório.
        </div>
      </div>

      <!-- CPF -->
      <div class="col-md-4" *ngIf="mostrarCnpj">
        <label class="form-label">CNPJ:</label>
        <input class="form-control" formControlName="cnpj" placeholder="Somente números" maxlength="18"
          mask="00.000.000/0000-00" />
        <div *ngIf="clienteForm.get('cnpj')?.invalid && clienteForm.get('cnpj')?.touched" class="text-danger">
          CNPJ inválido (deve conter 14 números).
        </div>
      </div>

      <!-- CPF -->
      <div class="col-md-4" *ngIf="mostrarCpf">
        <label class="form-label">CPF:</label>
        <input class="form-control" formControlName="cpf" placeholder="Somente números" maxlength="14"
          mask="000.000.000-00" />
        <div *ngIf="clienteForm.get('cpf')?.invalid && clienteForm.get('cpf')?.touched" class="text-danger">
          CPF inválido (deve conter 11 números).
        </div>
      </div>

      <!-- Botão -->
      <div class="col-12 mt-3">
        <button type="submit" class="btn btn-primary" [disabled]="clienteForm.invalid">Salvar</button>
      </div>

    </form>
    <div>
      <h3 class="mt-4">Clientes Cadastrados</h3>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Nome</th>           
            <th>Tipo</th>
            <th *ngIf="!mobile">CPF</th>
            <th *ngIf="!mobile">CNPJ</th>
            <th *ngIf="!mobile">Telefone</th>
            <th *ngIf="!mobile">Email</th>
            <th class="text-center">Ação</th>

          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let cliente of listaClientes">
            <td>{{ cliente.nome }}</td>            
            <td>{{ getTipo(cliente.tipoCliente) }}</td>
            <td *ngIf="!mobile">{{ cliente.cpf ? global.mascararTexto(cliente.cpf) : '--' }}</td>
            <td *ngIf="!mobile">{{ cliente.cnpj ? global.mascararTexto(cliente.cnpj) : '--' }}</td>
            <td *ngIf="!mobile">{{ cliente.telefone }}</td>
            <td *ngIf="!mobile">{{ cliente.email }}</td>
            <td class="d-flex gap-1 justify-content-center">
              <button class="btn btn-danger btn-sm" (click)="removerCliente(cliente)">
                <i class="fa-regular fa-trash-can"></i>
              </button>
              <button class="btn btn-secondary btn-sm" (click)="editarCliente(cliente)">
                <i class="fa-regular fa-pen-to-square"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>
</main>